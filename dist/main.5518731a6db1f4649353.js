(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var s=e.g.document;if(!t&&s&&(s.currentScript&&"SCRIPT"===s.currentScript.tagName.toUpperCase()&&(t=s.currentScript.src),!t)){var r=s.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=r[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();class t{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class s extends t{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".popup__input"),this._submitButton=this._form.querySelector(".popup__save-button"),this._defaultButtonText=this._submitButton.textContent}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){super.close(),this._form.reset()}renderLoading(e,t="Saving..."){this._submitButton.textContent=e?t:this._defaultButtonText}}const r=e.p+"images/heart.svg",i=e.p+"images/heart-filled.svg";class n{constructor(e,t,s,r,i,n){this._name=e.name,this._link=e.link,this._likes=e.likes||[],this._cardId=e._id,this._ownerId=e.owner?._id||e.owner,this._userId=t,this._templateSelector=s,this._handleImageClick=r,this._handleDeleteClick=i,this._handleLikeClick=n}generateCard(){if(this._element=this._getTemplate(),!this._element)return null;this._cardImage=this._element.querySelector(".card__image"),this._likeButton=this._element.querySelector(".card__like-button"),this._deleteButton=this._element.querySelector(".card__delete-button");const e=this._element.querySelector(".card__title");return this._cardImage.src=this._link,this._cardImage.alt=this._name,e.textContent=this._name,this._setEventListeners(),this.updateLikes(this._likes),this._element}_getTemplate(){const e=document.querySelector(this._templateSelector);return e?e.content.querySelector(".card").cloneNode(!0):null}updateLikes(e){console.log("updateLikes called with:",e),this._likes=Array.isArray(e)?e:[],this._likeState=this._likes.some((e=>e._id===this._userId)),this._updateLikeState()}_isLiked(){return!!Array.isArray(this._likes)&&this._likes.some((e=>e._id===this._userId))}_updateLikeState(){this._likeButton?(console.log("Like state is:",this._likeState),this._likeButton.style.backgroundImage=this._likeState?`url(${i})`:`url(${r})`):console.warn("Like button not found.")}_removeCard(){this._element.remove(),this._element=null}_setEventListeners(){this._likeButton&&this._likeButton.addEventListener("click",(()=>{this._handleLikeClick(this._cardId,this._isLiked(),this)})),this._deleteButton&&this._deleteButton.addEventListener("click",(()=>{this._handleDeleteClick(this._cardId,this._element)})),this._cardImage&&this._cardImage.addEventListener("click",(()=>{this._handleImageClick(this._name,this._link)}))}}class o{constructor(e,t){this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector)}_showInputError(e,t){const s=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._config.inputErrorClass),s.textContent=t,s.classList.add(this._config.errorVisibleClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorVisibleClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid||e.required&&0===e.value.length))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._config.inactiveButtonClass)):(this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._config.inactiveButtonClass))}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){console.log("resetValidation called"),this._inputList.forEach((e=>{this._hideInputError(e)})),this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._config.inactiveButtonClass)}}const a=e.p+"images/logo.svg",l=e.p+"images/jacques-cousteau.jpg";document.querySelector(".header__logo").src=a;const u=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t={}){const s={headers:this._headers,...t},r=`${this._baseUrl}${e}`;return fetch(r,s).then(this._checkResponse)}getUserInfo(){return this._request("/users/me")}getInitialCards(){return this._request("/cards")}getCardById(e){return this._request(`/cards/${e}`)}updateUserInfo(e){return this._request("/users/me",{method:"PATCH",body:JSON.stringify({name:e.name,about:e.about})})}addNewCard(e){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e.name,link:e.link})})}deleteCard(e){return this._request(`/cards/${e}`,{method:"DELETE"})}addLike(e){return this._request(`/cards/${e}/likes`,{method:"PUT"})}removeLike(e){return this._request(`/cards/${e}/likes`,{method:"DELETE"})}updateAvatar(e){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e.avatar})})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"49b1b68f-7c8f-45c7-9c0e-4dcf6a213fcc","Content-Type":"application/json"}}),c=new class{constructor({nameSelector:e,aboutSelector:t,avatarSelector:s}){this._nameElement=document.querySelector(e),this._aboutElement=document.querySelector(t),this._avatarElement=document.querySelector(s),this._userId=null}getUserInfo(){return{name:this._nameElement.textContent,about:this._aboutElement.textContent,avatar:this._avatarElement.src,id:this._userId}}setUserInfo({name:e,about:t,avatar:s,_id:r}){e&&(this._nameElement.textContent=e),t&&(this._aboutElement.textContent=t),s&&(this._avatarElement.src=s),r&&(this._userId=r)}getUserId(){return this._userId}}({nameSelector:".profile__name",aboutSelector:".profile__about",avatarSelector:".profile__image"}),d=new class extends t{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._caption=this._popup.querySelector(".popup__caption")}open(e){this._image.src=e.link,this._image.alt=e.name,this._caption.textContent=e.name,super.open()}}("#image-popup"),_=new s("#edit-popup",(function(e){_.renderLoading(!0),u.updateUserInfo(e).then((e=>{c.setUserInfo({name:e.name,about:e.about}),_.close()})).catch((e=>B(e))).finally((()=>_.renderLoading(!1)))})),h=new s("#add-popup",(function(e){h.renderLoading(!0),u.addNewCard(e).then((e=>{!function(e){const t=C(e);f.addItem(t)}(e),h.close()})).catch((e=>B(e))).finally((()=>h.renderLoading(!1)))})),p=new s("#avatar-popup",(function(e){p.renderLoading(!0),u.updateAvatar({avatar:e.avatar}).then((e=>{c.setUserInfo({avatar:e.avatar}),p.close()})).catch((e=>B(e))).finally((()=>p.renderLoading(!1)))})),m=new class extends t{constructor(e){super(e),this._formElement=this._popup.querySelector(".popup__form"),this._submitButton=this._formElement.querySelector(".popup__save-button"),this._defaultButtonText=this._submitButton.textContent}setSubmitAction(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit&&this._handleSubmit()}))}renderLoading(e,t="Saving..."){this._submitButton.textContent=e?t:this._defaultButtonText}}("#confirm-popup");d.setEventListeners(),_.setEventListeners(),h.setEventListeners(),p.setEventListeners(),m.setEventListeners();const f=new class{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s)}setItems(e){this._items=e}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:[],renderer:e=>{const t=C(e);f.addItem(t)}},".cards");f.setItems=function(e){this._items=e};const g=document.querySelector(".loading-text");u.getUserInfo().then((e=>(c.setUserInfo({name:e.name,about:e.about,avatar:e.avatar||l,_id:e._id}),u.getInitialCards()))).then((e=>{f.setItems(e.reverse()),f.renderItems(),g&&(g.style.display="none")})).catch((e=>{B(e),g&&(g.textContent="Failed to load cards. Please try again later.")}));const v=document.forms["add-form"],b=document.querySelector("#name"),E=document.querySelector("#about"),L=v.querySelector("#place"),k=v.querySelector("#link"),S=document.querySelector(".profile__add-button");document.querySelector(".profile__edit-button").addEventListener("click",(()=>{const e=c.getUserInfo();b.value=e.name,E.value=e.about,y["edit-form"].resetValidation(),_.open()})),S.addEventListener("click",(()=>{L.value="",k.value="",y["add-form"].resetValidation(),h.open()})),document.querySelector(".profile__image").addEventListener("click",(()=>{y["avatar-form"].resetValidation(),p.open()}));const y={};var I;function C(e){return new n(e,c.getUserId(),"#card-template",q,((e,t)=>new Promise(((s,r)=>{m.setSubmitAction((()=>{m.renderLoading(!0),u.deleteCard(e).then((()=>{t.remove(),s(),m.close()})).catch((e=>{B(e),r(e)})).finally((()=>m.renderLoading(!1)))})),m.open()}))),w).generateCard()}function q(e,t){d.open({name:e,link:t})}function w(e,t,s){(t?u.removeLike(e):u.addLike(e)).then((e=>{console.log("API Like Response:",e);let r=Array.isArray(e.likes)?e.likes:[];if(!r.length){console.log("Fallback: manually updating likes...");const e=c.getUserId();r=t?s._likes.filter((t=>t._id!==e)):[...s._likes,{_id:e}]}s.updateLikes(r)})).catch((e=>{B(e)}))}function B(e){alert(`An error occurred: ${e}`),console.error(e)}I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error",errorVisibleClass:"popup__error_visible"},Array.from(document.querySelectorAll(I.formSelector)).forEach((e=>{const t=new o(I,e),s=e.getAttribute("name");y[s]=t,t.enableValidation()}))})();