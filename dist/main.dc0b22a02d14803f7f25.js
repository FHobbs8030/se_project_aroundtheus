(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var s=e.g.document;if(!t&&s&&(s.currentScript&&"SCRIPT"===s.currentScript.tagName.toUpperCase()&&(t=s.currentScript.src),!t)){var n=s.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input-type-error",errorClass:"popup__input-error_visible"};console.log("initialCards:",[{name:"Yosemite Valley",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/yosemite.jpg",alt:"Yosemite Valley"},{name:"Lake Louise",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/lake-louise.jpg",alt:"Lake Louise"},{name:"Bald Mountains",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/bald-mountains.jpg",alt:"Bald Mountains"},{name:"Latemar",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/latemar.jpg",alt:"Latemar"},{name:"Vanoise National Park",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/vanoise.jpg",alt:"Vanoise National Park"},{name:"Lago di Braies",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/lago.jpg",alt:"Lago di Braies"}]),console.log("validationConfig:",t);class s{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class n extends s{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".popup__input"),this._submitButton=this._form.querySelector(".popup__save-button"),this._defaultButtonText=this._submitButton.textContent}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){super.close(),this._form.reset()}renderLoading(e,t="Saving..."){this._submitButton.textContent=e?t:this._defaultButtonText}}const r=e.p+"images/heart.svg",i=e.p+"images/heart-filled.svg";console.log("Heart icon webpack path:",r),console.log("Heart filled icon webpack path:",i);class a{constructor(e,t,s,n,r,i){this._name=e.name,this._link=e.link,this._likes=e.likes||[],this._cardId=e._id,this._ownerId=e.owner?._id||e.owner,this._userId=t,this._templateSelector=s,this._handleImageClick=n,this._handleDeleteClick=r,this._handleLikeClick=i}_getTemplate(){const e=document.querySelector(this._templateSelector);return e?e.content.querySelector(".card").cloneNode(!0):null}_updateLikes(e){this._likes=e||[];const t=this._element.querySelector(".card__like-count");t&&(0===this._likes.length?t.textContent="":t.textContent=this._likes.length),this._updateLikeState()}_isLiked(){return Array.isArray(this._likes)&&this._likes.some((e=>e._id===this._userId||e===this._userId))}_updateLikeState(){this._likeButton&&(this._likeButton.style.backgroundImage=this._isLiked()?`url(${i})`:`url(${r})`)}_removeCard(){this._element.remove(),this._element=null}_setEventListeners(){this._likeButton&&this._likeButton.addEventListener("click",(()=>{this._handleLikeClick(this._cardId,this._isLiked()).then((e=>{e&&e.likes&&this._updateLikes(e.likes)})).catch((e=>console.error("Like update failed:",e)))})),this._cardImage&&this._cardImage.addEventListener("click",(()=>{this._handleImageClick(this._name,this._link)})),this._deleteButton&&this._deleteButton.addEventListener("click",(()=>{this._handleDeleteClick(this._cardId).then((()=>{this._removeCard()})).catch((e=>console.error("Delete failed:",e)))}))}generateCard(){return this._element=this._getTemplate(),this._element?(this._cardImage=this._element.querySelector(".card__image"),this._likeButton=this._element.querySelector(".card__heart"),this._likeCount=this._element.querySelector(".card__like-count"),this._deleteButton=this._element.querySelector(".card__delete-button"),this._element.querySelector(".card__title").textContent=this._name,this._cardImage.src=this._link,this._cardImage.onerror=()=>{console.error(`Failed to load image: ${this._link}`),this._cardImage.src="path/to/fallback-image.jpg"},this._cardImage.alt=this._name,this._likeCount&&(0===this._likes.length?this._likeCount.textContent="":this._likeCount.textContent=this._likes.length),this._ownerId!==this._userId&&this._deleteButton&&this._deleteButton.remove(),this._updateLikeState(),this._setEventListeners(),this._element):null}}class o{constructor(e,t){this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector)}_showInputError(e,t){const s=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._config.inputErrorClass),s.textContent=t,s.classList.add(this._config.errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._config.inactiveButtonClass)):(this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._config.inactiveButtonClass))}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}}const l=e.p+"images/logo.svg",c=e.p+"images/jacques-cousteau.jpg";document.querySelector(".header__logo").src=l;const h=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getCardById(e){return fetch(`${this._baseUrl}/cards/${e}`,{headers:this._headers}).then(this._checkResponse)}updateUserInfo(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkResponse)}addNewCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}removeLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"49b1b68f-7c8f-45c7-9c0e-4dcf6a213fcc","Content-Type":"application/json"}}),u=new class{constructor({nameSelector:e,aboutSelector:t,avatarSelector:s}){this._nameElement=document.querySelector(e),this._aboutElement=document.querySelector(t),this._avatarElement=document.querySelector(s),this._userId=null}getUserInfo(){return{name:this._nameElement.textContent,about:this._aboutElement.textContent,avatar:this._avatarElement.src,id:this._userId}}setUserInfo({name:e,about:t,avatar:s,_id:n}){e&&(this._nameElement.textContent=e),t&&(this._aboutElement.textContent=t),s&&(this._avatarElement.src=s),n&&(this._userId=n)}getUserId(){return this._userId}}({nameSelector:".profile__name",aboutSelector:".profile__about",avatarSelector:".profile__image"}),d=new class extends s{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._caption=this._popup.querySelector(".popup__caption")}open(e){this._image.src=e.link,this._image.alt=e.name,this._caption.textContent=e.name,super.open()}}("#image-popup"),_=new n("#edit-popup",(function(e){_.renderLoading(!0),h.updateUserInfo(e).then((e=>{u.setUserInfo({name:e.name,about:e.about}),_.close()})).catch((e=>q(e))).finally((()=>_.renderLoading(!1)))})),p=new n("#add-popup",(function(e){p.renderLoading(!0),h.addNewCard(e).then((e=>{!function(e){const t=C(e);f.addItem(t)}(e),p.close()})).catch((e=>q(e))).finally((()=>p.renderLoading(!1)))})),m=new n("#avatar-popup",(function(e){m.renderLoading(!0),h.updateAvatar({avatar:e.avatar}).then((e=>{u.setUserInfo({avatar:e.avatar}),m.close()})).catch((e=>q(e))).finally((()=>m.renderLoading(!1)))})),g=new class extends s{constructor(e){super(e),this._formElement=this._popup.querySelector(".popup__form"),this._submitButton=this._formElement.querySelector(".popup__save-button"),this._defaultButtonText=this._submitButton.textContent}setSubmitAction(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit&&this._handleSubmit()}))}renderLoading(e,t="Saving..."){this._submitButton.textContent=e?t:this._defaultButtonText}}("#confirm-popup");d.setEventListeners(),_.setEventListeners(),p.setEventListeners(),m.setEventListeners(),g.setEventListeners();const f=new class{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s)}setItems(e){this._items=e}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:[],renderer:e=>{const t=C(e);f.addItem(t)}},".cards");f.setItems=function(e){this._items=e},h.getUserInfo().then((e=>(u.setUserInfo({name:e.name,about:e.about,avatar:e.avatar||c,_id:e._id}),h.getInitialCards()))).then((e=>{f.setItems(e.reverse()),f.renderItems()})).catch((e=>console.error(e)));const v=document.forms["add-form"],k=document.querySelector("#name"),b=document.querySelector("#about"),E=v.querySelector("#place"),L=v.querySelector("#link"),S=document.querySelector(".profile__add-button");document.querySelector(".profile__edit-button").addEventListener("click",(()=>{const e=u.getUserInfo();k.value=e.name,b.value=e.about,y["edit-form"].resetValidation(),_.open()})),S.addEventListener("click",(()=>{E.value="",L.value="",y["add-form"].resetValidation(),p.open()})),document.querySelector(".profile__image").addEventListener("click",(()=>{y["avatar-form"].resetValidation(),m.open()}));const y={};var I;function C(e){return new a(e,u.getUserId(),"#card-template",w,(e=>new Promise(((t,s)=>{g.setSubmitAction((()=>{g.renderLoading(!0),h.deleteCard(e).then((()=>{t(),g.close()})).catch((e=>{q(e),s(e)})).finally((()=>g.renderLoading(!1)))})),g.open()}))),B).generateCard()}function w(e,t){d.open({name:e,link:t})}function B(e,t){return(t?h.removeLike(e):h.addLike(e)).catch((e=>{q(e)}))}function q(e){alert(`An error occurred: ${e}`),console.error(e)}I=t,Array.from(document.querySelectorAll(I.formSelector)).forEach((e=>{const t=new o(I,e),s=e.getAttribute("name");y[s]=t,t.enableValidation()}))})();