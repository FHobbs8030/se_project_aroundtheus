(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var s=e.g.document;if(!t&&s&&(s.currentScript&&"SCRIPT"===s.currentScript.tagName.toUpperCase()&&(t=s.currentScript.src),!t)){var r=s.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=r[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();class t{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class s extends t{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._form?(this._inputList=this._form.querySelectorAll(".popup__input"),this._submitButton=this._form.querySelector(".popup__save-button"),this._submitButton?this._defaultButtonText=this._submitButton.textContent:console.error(`Submit button not found in form ${e}`)):console.error(`Form not found in popup ${e}`)}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){super.close(),this._form.reset()}renderLoading(e,t="Saving..."){this._submitButton.textContent=e?t:this._defaultButtonText}}const r=e.p+"images/heart.svg",n=e.p+"images/heart-filled.svg";class i{constructor(e,t,s,r,n,i){this._name=e.name,this._link=e.link,this._likes=e.likes||[],this._cardId=e._id,this._ownerId=e.owner?._id||e.owner,this._userId=t,this._templateSelector=s,this._handleImageClick=r,this._handleDeleteClick=n,this._handleLikeClick=i,this._liked=e.isLiked||!1}generateCard(){if(this._element=this._getTemplate(),!this._element)return null;this._cardImage=this._element.querySelector(".card__image"),this._likeButton=this._element.querySelector(".card__like-button"),this._likeCounter=this._element.querySelector(".card__like-count"),this._deleteButton=this._element.querySelector(".card__delete-button");const e=this._element.querySelector(".card__title");return this._cardImage.src=this._link,this._cardImage.alt=this._name,e.textContent=this._name,this._setEventListeners(),this.updateLikes(this._liked),this._element}_getTemplate(){const e=document.querySelector(this._templateSelector);return e?e.content.querySelector(".card").cloneNode(!0):null}updateLikes(e){this._liked=e,this._likeCounter&&(this._likeCounter.textContent=e?"1":"0"),this._updateLikeState()}_isLiked(){return this._liked}_updateLikeState(){this._likeButton&&(this._isLiked()?this._likeButton.style.backgroundImage=`url(${n})`:this._likeButton.style.backgroundImage=`url(${r})`)}_removeCard(){this._element.remove(),this._element=null}_setEventListeners(){this._likeButton&&this._likeButton.addEventListener("click",(()=>{this._handleLikeClick(this._cardId,this._isLiked(),this)})),this._deleteButton&&this._deleteButton.addEventListener("click",(()=>{this._handleDeleteClick(this._cardId,this._element)})),this._cardImage&&this._cardImage.addEventListener("click",(()=>{this._handleImageClick(this._name,this._link)}))}}class o{constructor(e,t){this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector)}_showInputError(e,t){const s=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._config.inputErrorClass),s.textContent=t,s.classList.add(this._config.errorVisibleClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorVisibleClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid||e.required&&0===e.value.length))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._config.inactiveButtonClass)):(this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._config.inactiveButtonClass))}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){console.log("resetValidation called"),this._inputList.forEach((e=>{this._hideInputError(e)})),this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._config.inactiveButtonClass)}}const a=e.p+"images/logo.svg",l=e.p+"images/jacques-cousteau.jpg",u=document.querySelector(".profile__avatar-wrapper");console.log("Avatar element:",u),document.querySelector(".header__logo").src=a;const c=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t={}){const s={headers:this._headers,...t},r=`${this._baseUrl}${e}`;return fetch(r,s).then(this._checkResponse)}getUserInfo(){return this._request("/users/me")}getInitialCards(){return this._request("/cards")}getCardById(e){return this._request(`/cards/${e}`)}updateUserInfo(e){return this._request("/users/me",{method:"PATCH",body:JSON.stringify({name:e.name,about:e.about})})}addNewCard(e){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e.name,link:e.link})})}deleteCard(e){return this._request(`/cards/${e}`,{method:"DELETE"})}addLike(e){return this._request(`/cards/${e}/likes`,{method:"PUT"})}removeLike(e){return this._request(`/cards/${e}/likes`,{method:"DELETE"})}updateAvatar(e){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e.avatar})})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"49b1b68f-7c8f-45c7-9c0e-4dcf6a213fcc","Content-Type":"application/json"}}),d=new class{constructor({nameSelector:e,aboutSelector:t,avatarSelector:s}){this._nameElement=document.querySelector(e),this._aboutElement=document.querySelector(t),this._avatarElement=document.querySelector(s),this._userId=null}getUserInfo(){return{name:this._nameElement.textContent,about:this._aboutElement.textContent,avatar:this._avatarElement.src,id:this._userId}}setUserInfo({name:e,about:t,avatar:s,_id:r}){e&&(this._nameElement.textContent=e),t&&(this._aboutElement.textContent=t),s&&(this._avatarElement.src=s),r&&(this._userId=r)}getUserId(){return this._userId}}({nameSelector:".profile__name",aboutSelector:".profile__about",avatarSelector:".profile__image"}),_=new class extends t{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._caption=this._popup.querySelector(".popup__caption")}open(e){this._image.src=e.link,this._image.alt=e.name,this._caption.textContent=e.name,super.open()}}("#image-popup"),h=new s("#edit-popup",(function(e){h.renderLoading(!0),c.updateUserInfo(e).then((e=>{d.setUserInfo({name:e.name,about:e.about}),h.close()})).catch((e=>x(e))).finally((()=>h.renderLoading(!1)))})),p=new s("#add-popup",(function(e){p.renderLoading(!0),c.addNewCard(e).then((e=>{!function(e){const t=q(e);v.addItem(t)}(e),p.close()})).catch((e=>x(e))).finally((()=>p.renderLoading(!1)))})),m=new s("#avatar-popup",(function(e){m.renderLoading(!0),c.updateAvatar({avatar:e.avatar}).then((e=>{d.setUserInfo({avatar:e.avatar}),m.close()})).catch((e=>x(e))).finally((()=>m.renderLoading(!1)))}));console.log("Avatar popup initialized:",m);const f=new class extends t{constructor(e){super(e),this._formElement=this._popup.querySelector(".popup__form"),this._submitButton=this._formElement.querySelector(".popup__save-button"),this._defaultButtonText=this._submitButton.textContent}setSubmitAction(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit&&this._handleSubmit()}))}renderLoading(e,t="Deleting..."){this._submitButton.textContent=e?t:this._defaultButtonText}}("#confirm-popup");_.setEventListeners(),h.setEventListeners(),p.setEventListeners(),m.setEventListeners(),f.setEventListeners();const v=new class{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s)}setItems(e){this._items=e}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:[],renderer:e=>{const t=q(e);v.addItem(t)}},".cards");v.setItems=function(e){this._items=e};const g=document.querySelector(".loading-text");c.getUserInfo().then((e=>(console.log("API avatar URL:",e.avatar),d.setUserInfo({name:e.name,about:e.about,avatar:l,_id:e._id}),c.getInitialCards()))).then((e=>{console.log("Cards received from API:",e),v.setItems(e.reverse()),v.renderItems(),g&&(g.style.display="none")})).catch((e=>{x(e),g&&(g.textContent="Failed to load cards. Please try again later.")}));const b=document.forms["add-form"],E=document.querySelector("#name"),L=document.querySelector("#about"),S=b.querySelector("#place"),k=b.querySelector("#link"),y=document.querySelector(".profile__add-button");document.querySelector(".profile__edit-button").addEventListener("click",(()=>{const e=d.getUserInfo();E.value=e.name,L.value=e.about,I["edit-form"].resetValidation(),h.open()})),y.addEventListener("click",(()=>{S.value="",k.value="",I["add-form"].resetValidation(),p.open()})),document.querySelector(".profile__avatar-wrapper").addEventListener("click",(()=>{console.log("Avatar clicked!"),I["avatar-form"].resetValidation(),m.open()}));const I={};var C;function q(e){return new i(e,d.getUserId(),"#card-template",B,((e,t)=>new Promise(((s,r)=>{f.setSubmitAction((()=>{f.renderLoading(!0),c.deleteCard(e).then((()=>{t.remove(),s(),f.close()})).catch((e=>{x(e),r(e)})).finally((()=>f.renderLoading(!1)))})),f.open()}))),w).generateCard()}function B(e,t){_.open({name:e,link:t})}function w(e,t,s){(t?c.removeLike(e):c.addLike(e)).then((e=>{console.log("API Like Response:",e),s.updateLikes(e.isLiked)})).catch((e=>{x(e)}))}function x(e){alert(`An error occurred: ${e}`),console.error(e)}C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error",errorVisibleClass:"popup__error_visible"},Array.from(document.querySelectorAll(C.formSelector)).forEach((e=>{const t=new o(C,e),s=e.getAttribute("name");I[s]=t,t.enableValidation()}))})();