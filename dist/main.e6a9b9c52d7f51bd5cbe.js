(()=>{"use strict";var e="";const t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input-type-error",errorClass:"popup__input-error_visible"};console.log("initialCards:",[{name:"Yosemite Valley",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/yosemite.jpg",alt:"Yosemite Valley"},{name:"Lake Louise",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/lake-louise.jpg",alt:"Lake Louise"},{name:"Bald Mountains",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/bald-mountains.jpg",alt:"Bald Mountains"},{name:"Latemar",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/latemar.jpg",alt:"Latemar"},{name:"Vanoise National Park",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/vanoise.jpg",alt:"Vanoise National Park"},{name:"Lago di Braies",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/lago.jpg",alt:"Lago di Braies"}]),console.log("validationConfig:",t);class s{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class n extends s{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=Array.from(this._form.querySelectorAll(".popup__input")),this._submitButton=this._form.querySelector(".popup__save-button"),this._defaultSubmitText=this._submitButton.textContent}setInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submitButton.textContent="Saving...";const t=this._getInputValues(),s=this._handleFormSubmit(t);s instanceof Promise?s.then((()=>{this._form.reset(),this.close()})).catch((e=>console.error(e))).finally((()=>{this._submitButton.textContent=this._defaultSubmitText})):(this._form.reset(),this.close(),this._submitButton.textContent=this._defaultSubmitText)}))}close(){super.close(),this._form.reset()}open(){super.open()}}class r{constructor(e,t,s,n,r,i){this._name=e.name,this._link=e.link,this._likes=e.likes||[],this._cardId=e._id,this._ownerId=e.owner?._id,this._userId=t,this._templateSelector=s,this._handleImageClick=n,this._handleDeleteClick=r,this._handleLikeClick=i}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}_isLiked(){return this._likes.some((e=>e._id===this._userId))}_updateLikeState(){this._isLiked()?this._likeButton.classList.add("card__heart_active"):this._likeButton.classList.remove("card__heart_active"),this._likeCount.textContent=this._likes.length}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._handleLikeClick(this._cardId,this._isLiked(),(e=>{this._likes=e,this._updateLikeState()}))})),this._imageElement.addEventListener("click",(()=>{this._handleImageClick({name:this._name,link:this._link})})),this._userId===this._ownerId?this._deleteButton.addEventListener("click",(()=>{this._handleDeleteClick(this._cardId).then((()=>{this._element.remove(),this._element=null}))})):this._deleteButton.remove()}generateCard(){return this._element=this._getTemplate(),this._imageElement=this._element.querySelector(".card__image"),this._likeButton=this._element.querySelector(".card__heart"),this._likeCount=this._element.querySelector(".card__like-count"),this._deleteButton=this._element.querySelector(".card__delete-button"),this._element.querySelector(".card__title").textContent=this._name,this._imageElement.src=this._link,this._imageElement.alt=this._name,this._updateLikeState(),this._setEventListeners(),this._element}}class i{constructor(e,t){this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector)}_showInputError(e,t){const s=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._config.inputErrorClass),s.textContent=t,s.classList.add(this._config.errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._config.inactiveButtonClass)):(this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._config.inactiveButtonClass))}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}}const o=e+"4e8e0a1d604782a0dff8.svg",a=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}async updateUserInfo(e){const t=await fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})});return this._checkResponse(t)}async addNewCard(e){const t=await fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})});return this._checkResponse(t)}async deleteCard(e){const t=await fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers});return this._checkResponse(t)}addLike(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}removeLike(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"370afff2-dc2e-4ff4-9a42-bff9c2721dd0","Content-Type":"application/json"}}),c=new class{constructor({nameSelector:e,aboutSelector:t,avatarSelector:s}){this._nameElement=document.querySelector(e),this._aboutElement=document.querySelector(t),this._avatarElement=document.querySelector(s),this._id=null}getUserInfo(){return{name:this._nameElement.textContent,about:this._aboutElement.textContent,avatar:this._avatarElement.src}}getUserId(){return this._id}setUserInfo({name:e,about:t,avatar:s,_id:n}){this._nameElement.textContent=e,this._aboutElement.textContent=t,s&&(this._avatarElement.src=s),n&&(this._id=n)}}({nameSelector:".profile__name",aboutSelector:".profile__about",avatarSelector:".profile__image"});a.getUserInfo().then((e=>{console.log("User data received:",e),c.setUserInfo(e)})).catch((e=>console.error(e))),document.querySelector(".header__logo").src=o,document.getElementById("add-popup");const l=document.forms["add-form"],h=(l.querySelector("#place"),l.querySelector("#link"),document.getElementById("edit-popup"),document.querySelector("#name")),u=document.querySelector("#about"),d=(document.querySelector(".profile__name"),document.querySelector(".profile__about"),document.querySelector(".profile__add-button")),_=document.querySelector(".profile__edit-button"),m=new class extends s{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._caption=this._popup.querySelector(".popup__caption")}open(e){this._image.src=e.link,this._image.alt=e.name,this._caption.textContent=e.name,super.open()}}("#image-popup"),p=new n("#edit-popup",(function(e){a.updateUserInfo(e).then((e=>{c.setUserInfo({name:e.name,about:e.about}),p.close()})).catch((e=>{console.error("Error updating profile:",e)}))})),f=new n("#add-popup",(function(e){a.addNewCard(e).then((e=>{b(e),f.close()})).catch((e=>console.error(e)))}));m.setEventListeners(),p.setEventListeners(),f.setEventListeners();const v=new class{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:[],renderer:e=>{const t=L(e);v.addItem(t)}},".cards");function E(e){m.open(e)}a.getInitialCards().then((e=>{e.reverse().forEach((e=>{b(e)}))})).catch((e=>console.error(e))),_.addEventListener("click",(()=>{g["edit-form"].resetValidation();const e=c.getUserInfo();h.value=e.name,u.value=e.about,p.open()})),d.addEventListener("click",(()=>{g["add-form"].resetValidation(),f.open()}));const g={};var k;function L(e){return new r(e,c.getUserId(),"#card-template",E,C,y).generateCard()}function b(e){const t=L(e);v.addItem(t)}k=t,Array.from(document.querySelectorAll(k.formSelector)).forEach((e=>{const t=new i(k,e),s=e.getAttribute("name");g[s]=t,t.enableValidation()})),document.addEventListener("DOMContentLoaded",(()=>{v.renderItems()}));const S=new n("#avatar-popup",(function(e){a.updateAvatar({avatar:e.avatar}).then((e=>{c.setUserInfo({avatar:e.avatar}),S.close()})).catch((e=>console.error("Error:",e)))}));function y(e,t,s){(t?a.removeLike(e):a.addLike(e)).then((e=>{s(e.likes)})).catch((e=>console.error(e)))}function C(e){return a.deleteCard(e).catch((e=>console.error(e)))}S.setEventListeners(),document.querySelector(".profile__image").addEventListener("click",(()=>{g["avatar-form"].resetValidation(),S.open()}))})();